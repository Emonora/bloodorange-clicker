<!DOCTYPE html>
<html>
    <head>
        <title>Simple web game</title>
        <meta charset="UTF-8">
        <style>
            .btn-cfc {
                padding: 10px;
                margin: 10px;
                cursor: pointer;
                position: absolute;
                top: 250px;
                left: 100px;
                background-color: #ff821b;
                border-color: black;
                border-radius: 5px;
                size: 50px;

            }
            .shop {
                position: absolute;
                top: -10px;
                left: 415px;
            }
            .buildings {
                position: absolute;
                top: 50px;
                left: 415px;
                size: 90px;
            }
            .cursor {
                position: absolute;
                width: 90px;
                height: 90px;
            }
            .btn-cfiuc {
                cursor: pointer;
                position: absolute;
                background-color: #ff821b;
                border-color: black;
                border-radius: 5px;
            }
            html {
                background-color: #e7700e;
            }
            .scorenum {
                position: absolute;
                top: -21px;
                left: 0px;
            }
            .scoreupd {
                animation: scoreupd 0.05s linear;
            }
            @keyframes scoreupd {
                0% {transform: scale(1);}
                60% {transform: scale(1.2);}
                80% {transform: scale(1.1);}
                100% {transform: scale(1);}
            }
            /*Add autoajusting css here */
        /* @media screen and (max-width: 480px) 
            {
            Styling for smaller windows goes here.
            }
            */
        </style>
    </head>
    <body>
        <main class="game">
            <h3 class="scorenum">0</h3>
          <button type="button" class="btn-cfc" onclick="scoreupdate()" title="THE BUTTON OF DOOM"></button>
        </main>
        <main class="shop">
            <div class="upgrades"></div>
            <br>
            <div class="buildings">
                <div class="cursor">
                    <button type="button" class="btn-cfiuc" onclick="purchase('cursor')" title="Increases currency gained per click"> Purchase a cursor</button>
                    <br style="line-height: 15px;"> a</br>
                    <p class="cursor-owned">Owned: 0</p>
                    <p class="cursor-cost">Cost: 10</p>
                </div>
            </div>
        </main>
    </body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.js"></script>
    <script>
        // score, upgrades, and buildings variables
        let score = 0;
        let buildings = [0,0,0,0,0];
        // cost variables
        let ccost = 10;
        // extra variables
        let h3 = document.getElementsByClassName("scorenum");

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function getcookies (neededcookie) {
        let cookies = document.cookie.split(';');
        let newcookie;
        for (let i = 0; i < cookies.length; i++) {
            let cookie = cookies[i].trim();
            if (neededcookie === "score") {
                if (cookie.startsWith("score=")) {
                score = parseInt(cookie.substring("score=".length));
                return score;
            }

            }
            if (neededcookie === "buildings") {
                if (cookie.startsWith("buildings=")) {
                console.log(cookie);
                if (cookie.charAt(9) == "=") {
                    newcookie = cookie.replace("=", " ");
                    newcookie.trim();
                }
                console.log(i);
                console.log(newcookie);
                let dcodeca = JSON.parse("[" + newcookie.substring("buildings".length) + "]");
                console.log(newcookie);
                console.log(dcodeca);
                if (dcodeca != "undefined" && dcodeca != "NaN" && dcodeca != null && cookie.charAt(0) != '=' && cookie.charAt(1) != '=' && cookie.charAt(2) != '=' ) {
                    buildings = dcodeca;
                    return;
                }
                return;
                }
            }
        }
    }

        function setcookies (score, buildings) {
            document.cookie ='score=' + score + '; path=/';
            document.cookie = "buildings=" + JSON.stringify(buildings) + "; path=/";
        }

        // load cookies on page load and update score value accordingly.
        if (getcookies("score") != null) {
            $('.scorenum').text(getcookies("score"));
            score = getcookies("score"); // update score value to avoid re-calculating it in case of page refresh or back navigation.
        } if (getcookies() != null) {
            buildings = getcookies("buildings"); // update buildings value to avoid re-calculating it in case of page refresh or back navigation.
            console.log(buildings); 
            if (buildings != "undefined" && buildings != "NaN" && buildings != null) {
                console.log(buildings);
                $('.cursor-owned').text("You Own: " + buildings[0]);
                $('.cursor-cost').text("Cost: " + (10 * Math.pow(2, buildings[0])));
                ccost = 10 * Math.pow(2, buildings[0]);
            }
            //buildings = [0,0,0,0,0];
            console.log(buildings);
        } else {
            setcookies(score, buildings);
            buildings = [0,0,0,0,0];
            setcookies(score, buildings); // update buildings value to avoid re-cal
            ccost = 10 * Math.pow(2, buildings[0]);
            $('.cursor-owned').text("You Own: " + buildings[0]);
            $('.cursor-cost').text("Cost: " + (10 * Math.pow(2, buildings[0])));
        }

        async function scoreupdate () {
            score++;
            if (buildings[0] > 0) {
                let totcursor = buildings[0];
                let upgradebonus = 0;
                score += totcursor;
                score += upgradebonus;
            }
            $('.scorenum').text(score);
            $(h3).addClass('scoreupd');
            await sleep(51);
            $(h3).removeClass('scoreupd');
            setcookies(score, buildings);
        }

        function purchase (building) {
            if (building == "cursor") {
                if (score >= ccost) {
                    score -= ccost;
                    scoreupdate(score);
                    console.log(buildings);
                    buildings.splice(0,1,buildings[0]+1);
                    console.log(buildings);
                    setcookies(score, buildings);
                    $('.cursor-owned').text("You Own: " + buildings[0]);
                    $('.cursor-cost').text("Cost: " + (10 * Math.pow(2, buildings[0])));
                    ccost = 10 * Math.pow(2, buildings[0]);
                } else {
                    alert("Not enough points!");
                }
            }
        }
    </script>
</html>
